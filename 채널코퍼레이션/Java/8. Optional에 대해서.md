


```

[이펙티브 자바]

자바 8 전에는 메서드가 특정 조건에서 값을 반환할 수 없을 때, 취할 수 있는 선택지가 두 가지 있었다.
예외를 던지거나, (반환 타입이 객체 참조라면) null을 반환하는 것이다.

두 방법 모두 허점이 있다. 예외는 진짜 예외적인 상황에서만 사용해야 하며(아이템 69)
예외를 생성할 때 스택 추적 전체를 캡처하므로 비용도 만만치 않다.

null을 반환하면 이런 문제가 생기지 않지만, 그 나름의 문제가 있다.
null을 반환할 수 있는 메서드를 호출할 때는, (null이 반환될 일이 절대 없다고 확신하지 않는 한)
별도의 null 처리 코드를 추가해야 한다.

null 처리를 무시하고 반환된 null 값을 어딘가에 저장해두면 언젠가 NullPointerException이 발생할 수 있다
그것도 근본적인 원인, 즉 null을 반환하게 한 실제 원인과는 전혀 상관 없는 코드에서 말이다.

자바 버전이 8로 올라가면서 또 하나의 선택지가 생겼다.
그 주인공인 Optional<T>는 null이 아닌 T 타입 참조를 하나 담거나,
혹은 아무것도 담지 않을 수 있다.
아무것도 담지 않은 옵셔널은 '비었다'고 말한다. 반대로 어떤 값을 담은 옵셔널은 '비지 않았다'고 한다.
옵셔널은 원소를 최대 1개 가질 수 있는 '불변'컬렉션이다. Optional<T>가 Collection<T>를 반환하도록 선언하면 된다.
그러면 유효한 반환값이 없을 때는 빈 결과를 반환하는 메서드가 만들어진다.
옵셔널은 반환하는 메서드는 예외를 던지는 메서드보다 유연하고 사용하기 쉬우며,
null을 반환하는 메서드보다 오류 가능성이 적다.

아이템 30에서도 등장했던 코드 55-1은 주어진 컬렉션에서 최댓값을 뽑아주는 메서드다.

코드 55-1
이 메서드에 빈 컬렉션을 건네면 IllegalArgumentException을 던진다.
아이템 30에서도 Optional<E>를 반환하는 편이 더 낫다고 이야기했는데,
그렇게 수정한 모습은 다음과 같다.

보다시피 옵셔널을 반환하도록 구현하기는 어렵지 않다.
적절한 정적 팩터리를 사용해 옵셔널을 생성해주기만 하면 된다.
이 코드에서는 두 가지 팩터리를 사용했다.
빈 옵셔널은 Optional.empty()로 만들고, 값이 든 옵셔널은 Optional.of(value)로 생성했다.
Optional.of(value)에 null을 넣으면, null을 넣으면 NullPointerException을 던지니 주의하자.
null 값도 허용하는 옵셔널을 만들려면 Optional.ofNullable(value)를 사용하면 된다.

옵셔널을 반환하는 메서드에서는 절대 null을 반환하지 말자.
옵셔널을 도입한 취지를 완전히 무시하는 행위다.

```

