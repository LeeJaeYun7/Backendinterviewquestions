

- 2장 두 번째 절인데 벌써 두 번째 쿠버네티스 객체, 컨트롤러 객체를 배우게 되었다
-> 컨트롤러 객체는 다른 객체를 다시 추상화한 것이다
-> 쿠버네티스가 매우 복잡한 시스템이기는 하지만, 이 복잡성이 바로 강력하고 다양한 설정이 가능한 시스템을 만드는 원동력이다.
-> 학습에 따르는 약간의 어려움은 전 세계적으로 널리 쓰이는 컨테이너 플랫폼에 참여할 수 있는 입장료라고 생각하자

- 파드는 직접 사용하기에는 너무 단순한 객체다
- -> 파드는 고립된 한 벌의 애플리케이션이며, 각 파드는 서로 다른 노드에 배정된다
- -> 어떤 노드가 고장을 일으킨다면 파드는 유실되며, 쿠버네티스는 유실된 파드를 새 파드로 대체하지 않는다
- -> 여러 파드를 실행하며, 고가용성을 확보하려고 해도 모든 파드가 다른 노드에 흩어져서 실행된다는 보장이 없다
- -> 억지로 서로 다른 노드에 실행되도록 사람이 직접 관리해야 한다면, 오케스트레이션 도구를 사용하는 의미가 없다

- 컨트롤러 객체가 바로 이런 불편함을 해결해준다
- -> 컨트롤러 객체는 다른 리소스를 관리하는 쿠버네티스 리소스다
- -> 컨트롤러는 쿠버네티스 API와 연동하며, 시스템의 현재 상태를 감시하다가 '바람직한 상태'와 차이가 생기면
-    필요에 따라, 그 차이를 바로 잡는다
- -> 쿠버네티스에는 여러가지 컨트롤러 객체가 있다
- -> 그중에서도 파드를 주로 관리하는 컨트롤러 객체는 디플로이먼트다
- -> 앞서 설명했던 파드의 문제점을 디플로이먼트가 모두 해결해준다
- -> 어떤 노드가 고장을 일으켜 파드가 유실되면, 디플로이먼트가 대체 파드를 다른 노드에 실행한다.
- -> 디플로이먼트를 스케일링 하고 싶다면, 필요한 파드 수를 지정하면 된다.

- - 그러면 디플로이먼트가 여러 노드에 걸쳐 필요한 수만큼 파드를 실행한다
  -> 그림 2-6은 디플로이먼트와 파드, 컨테이너의 관계를 나타낸 다이어그램이다.

- kubectl을 사용하여 컨테이너를 실행할 이미지와 파드 설정을 지정하면 디플로이먼트를 생성할 수 있다
-> 쿠버네티스가 디플로이먼트를 생성하면 디플로이먼트가 파드를 생성한다

-필자의 환경에서 실행한 결과를 그림 2-7에 실었다
-> 이제 클러스터에는 파드 두 개가 생겼다
-> 첫번째는 앞서 kubectl이 run 명령을 사용해서 만든 것이고, 두 번째는 디플로이먼트가 생성했다
-> 디플로이먼트가 생성한 파드 이름은 쿠버네티스가 지은 것으로, 디플로이먼트 이름 뒤에 무작위 문자열이 붙은 형태다. 

- 이번 실습에서 알아야 할 중요한 점은 우리가 디플로이먼트는 만들었지만, 파드를 직접 만든 적은 없다는 것이다
-> 디플로이먼트를 정의할 때, 우리에게 필요한 파드가 어떤 것인지 기술했다
-> 그러면 디플로이먼트는 쿠버네티스 API를 통해 현재 동작 중인 리소스가 무엇이 있는지 살펴보고, 자신이 관리해야 할 파드가 없다는 사실을 발견하여
  다시 쿠버네티스 API를 통해 자신에게 필요한 파드를 생성한다.
-> 구체적으로 어떤 과정을 거쳤는가는 중요하지 않다
-> 디플로이먼트만 만들면 우리에게 필요한 파드를 대신 만들어 준다는 점이 중요하다

-하지만 디플로이먼트가 자신이 관리해야 할 리소스를 어떻게 추적하는지는 알아 둘 필요가 있다
-> 이런 패턴은 쿠버네티스 전반에서 매우 많이 쓰인다.
-> 모든 쿠버네티스 리소스는 간단한 키-값 쌍 형태의 레이블을 가지며, 이 레이블을 우리가 원하는 데이터를 담는 데 사용할 수 있다
-> 예를 들어, 디플로이먼트에 release라는 레이블을 추가하고, 그 값을 20.04라고 지정한다면, 우리는 나중에 이 디플로이먼트가 배포 주기 20.05에 
   배포된 것임을 알 수 있다
-> 또한, 레이블은 디플로이먼트와 파드의 관계처럼 객체 간 관계를 표현해서 리소스와 리소스의 느슨한 연결을 만드는데도 쓰인다. 

-필자의 환경에서 실행한 결과를 그림 2-8에 실었다
-> 출력된 내용을 보면 컨트롤러 객체가 자신이 관리하는 리소스를 어떤 식으로 설정하는지 조금이나마 엿볼 수 있다
-> 디플로이먼트는 템플릿을 적용해서 파드를 생성하는데, 이 템플릿 일부는 메타데이터 필드로 레이블을 포함한다
-> 여기에서는 디플로이먼트가 app이라는 레이블에 hello-kiamol-2라는 값을 달아 파드에 부여했다
-> 이 레이블이 일치하는 파드를 검색했더니 디플로이먼트가 관리하는 파드를 찾았다 

-레이블을 이용하여 리소스 간 관계를 파악하는 것은 쿠버네티스에서 매우 자주 쓰는 중요한 패턴이다
-> 별도의 다이어그램과 함께 설명하겠으니 확실히 이해해 두기 바란다.
-> 리소스는 생애 주기를 거치며 생성이나 수정, 삭제와 함께 레이블을 부여 받는다
-> 또한, 컨트롤러 객체는 레이블 셀렉터를 통해 자신이 관리하는 리소스인지 판단한다
-> 이 과정은 그림 2-9에서 보듯이, 리소스가 가진 특정한 레이블이 일치하는지 확인하는 과정이다. 



